# 操作系统基础

---

APP——==OS==——硬件

## 研究内容

CPU管理、内存管理、终端管理、磁盘管理、文件管理

从应用软件出发“探到操作系统”，==从应用软件出发“进入操作系统”==，从硬件出发“设计并实现操作系统”

## 实现目标

能改动操作系统，能在真实的基本操作系统上动手实践

---

# Learn OS concepts by coding them

---

# L2. Open the OS

打开电源——计算机开始工作——==如何工作==

思索如何工作——写成代码——OS

#### ==最最基本、最最重要的常识==

#### 1.图灵机

是一个计算模型的实现。3+2=5，在纸带上读入3，在纸带上读入2，在纸带上读入+，控制器查表知道是5，在纸带上写下5

#### 2.通用图灵机

图灵机：一个会做一道菜的厨师
通用图灵机：一个能看懂菜谱的厨师

纸带上：==设置控制器动作==、控制器状态、(处理)数据对象

读入加法，就可以做加法，读入乘法，就可以做乘法

#### 3.计算机

### ==冯·诺依曼存储程序思想==

主要思想：将程序和数据放到计算机内部的存储器中，计算机在程序的控制下一步一步进行处理

# ==取指执行==

---

打开电源，计算机执行的第一句指令是什么？IP=？

#### 这个由硬件设计者决定

x86结构，即因特尔结构

+ x86的PC刚开机时CPU处于实模式（和保护模式对应，实模式的寻址CS:IP（CS左移4位+IP），和保护模式不一样）
+ 开机时，CS=0xFFFF；IP=0x0000
+ 寻址0xFFFF0（ROM BIOS映射区）
+ 检查RAM，键盘，显示器，软硬磁盘
+ 将磁盘0磁道0扇区(引导扇区)读入0x7c00处
+ 设置cs=0x07c0，ip=0x0000，这里CS<<4+IP为0x7c00
+ 开始执行被读入的引导扇区的代码

0x7c00处存放的代码：就是从磁盘==引导扇区==读入的那512个字节

引导扇区就是启动设备的第一个扇区，启动设备信息被设置在CMOS中
CMOS：互补金属氧化物半导体(64B-128B)，用来存储实时钟和硬件配置信息

#### 操作系统的所有故事从这里开始

---

引导扇区代码：bootsect.s   （.s是汇编代码的意思），会被编译成机器码存入引导扇区

读取顺序：boot扇区、setup的4个扇区、system模块（OS代码）

---

# L3.操作系统启动

#### ==常识==

OS一开始放置在硬盘上，取指执行需要将代码放在内存中。首先需要将OS从磁盘载入到内存中。需要由bootsect.s完成，bootsect.s分段读入操作系统，首先读入setup，然后打出logo，用BIOS的13号中断把system部分读入内存。

#### setup.s

将完成OS启动前的设置，相当于初始化，读取内存大小、显卡参数等

移动OS到0地址，然后进入保护模式

#### 保护模式——32位寻址方式

---

#### 保护模式下的地址翻译，即gdt的作用

#### system模块

---

BIOS读bootsect，bootsect读setup，setup读system，并跳转到第一部分head，再main，再mem_init等

#### Makefile控制大型软件的合成结构

main是一个永不退出是程序

---

## 教材也是恐龙书











